---
import AirfoilLayout from '../../layouts/AirfoilLayout.astro';
import AirfoilBanner from '../../components/airfoil/AirfoilBanner.astro';
import AirfoilTabs from '../../components/airfoil/AirfoilTabs.astro';
import MetadataCard from '../../components/airfoil/MetadataCard.astro';
import CoordinateDataCard from '../../components/airfoil/CoordinateDataCard.astro';
import Model3DCard from '../../components/airfoil/Model3DCard.astro';
import PerformanceCard from '../../components/airfoil/PerformanceCard.astro';
import DragPolarCard from '../../components/airfoil/DragPolarCard.astro';
import StructuralPropertiesCard from '../../components/airfoil/StructuralPropertiesCard.astro';

import airfoils from '../../data/airfoils.json';

export const prerender = true;

export async function getStaticPaths() {
  return Object.keys(airfoils).map((id) => ({ params: { id } }));
}

const { id } = Astro.params;
const airfoil = airfoils[id];

if (!airfoil) {
  throw new Error(`Airfoil not found for ID: ${id}`);
}

// Extract airfoil family, camber and thickness from name (for NACA airfoils)
let airfoilFamily = 'Unknown';
let camber = '0';
let camberPosition = '0';
let thickness = '12';

if (airfoil.name.startsWith('NACA')) {
  airfoilFamily = 'NACA';
  
  // For 4-digit NACA airfoils
  if (airfoil.name.slice(5).length === 4) {
    camber = airfoil.name.slice(5, 6);
    camberPosition = airfoil.name.slice(6, 7);
    thickness = airfoil.name.slice(7, 9);
  }
}

// Create enhanced metadata
const enhancedAirfoil = {
  id: id,
  name: airfoil.name,
  description: airfoil.description,
  family: airfoilFamily,
  camber: camber,
  camberPosition: camberPosition,
  thickness: thickness,
  thicknessPosition: "30", // Default value
  leadingEdgeRadius: "1.6", // Estimated
  coordinates: airfoil.coordinates,
  // Add simulated performance data
  performance: {
    maxCl: "1.45",
    maxClAoA: "16",
    zeroLiftAoA: "-2.0",
    stallAngle: "16",
    maxLiftDragRatio: "85",
    minCd: "0.0058",
    momentCoefficient: "-0.025",
  },
  // Add simulated structural data
  structural: {
    momentOfInertia: "0.00364",
    bendingStiffness: "4.23 × 10⁶",
    maxBendingMoment: "8.45",
    naturalFrequency: "12.8",
    fatigueLimit: "10⁶",
    fatigueLoad: "60",
    materialCompatibility: ["6061-T6", "Carbon Fiber", "Fiberglass"]
  },
  // Add simulated applications
  applications: ["General Aviation", "UAV", "Low-Speed Aircraft", "Wind Turbine", "RC Model"]
};
---

<AirfoilLayout title={`${airfoil.name} - AeroFoilPro`}>
  <!-- Breadcrumb Navigation -->
  <div class="mb-4">
    <nav class="flex" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-1 text-sm text-gray-600">
        <li>
          <a href="/" class="hover:text-blue-600">Home</a>
          <span class="mx-1">/</span>
        </li>
        <li>
          <a href="/browse" class="hover:text-blue-600">Browse</a>
          <span class="mx-1">/</span>
        </li>
        <li class="text-gray-900 font-medium">{airfoil.name}</li>
      </ol>
    </nav>
  </div>
  
  <AirfoilBanner name={airfoil.name} description={airfoil.description} />
  
  <AirfoilTabs />
  
  <div id="geometry-content" class="airfoil-tab-content active">
    <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left Column -->
      <div class="lg:col-span-2 space-y-6">
        <MetadataCard name={airfoil.name} />
        <CoordinateDataCard coordinates={airfoil.coordinates} />
        <StructuralPropertiesCard name={airfoil.name} />
      </div>
      
      <!-- Right Column -->
      <div class="space-y-6">
        <Model3DCard name={airfoil.name} coordinates={airfoil.coordinates} />
        <PerformanceCard name={airfoil.name} />
        <DragPolarCard name={airfoil.name} />
      </div>
    </div>
  </div>
  
  <div id="performance-content" class="airfoil-tab-content">
    <div class="mt-6">
      <PerformanceCard name={airfoil.name} />
    </div>
  </div>
  
  <div id="polar-content" class="airfoil-tab-content">
    <div class="mt-6">
      <DragPolarCard name={airfoil.name} />
    </div>
  </div>
  
  <div id="structural-content" class="airfoil-tab-content">
    <div class="mt-6">
      <StructuralPropertiesCard name={airfoil.name} />
    </div>
  </div>
  
  <div id="3d-content" class="airfoil-tab-content">
    <div class="mt-6">
      <Model3DCard name={airfoil.name} coordinates={airfoil.coordinates} />
    </div>
  </div>
</AirfoilLayout>